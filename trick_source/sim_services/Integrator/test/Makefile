
#SYNOPSIS:
#
#   make [all]  - makes everything.
#   make TARGET - makes the given target.
#   make clean  - removes all files generated by make.

include $(dir $(lastword $(MAKEFILE_LIST)))../../../../share/trick/makefiles/Makefile.common

# Flags passed to the preprocessor.
TRICK_CPPFLAGS += -I$(GTEST_HOME)/include -I$(TRICK_HOME)/include -I${TRICK_HOME}/trick_source -I${TRICK_HOME}/include/trick/compat -g -Wall -Wextra -DUSE_ER7_UTILS_INTEGRATORS=1 -DTEST ${TRICK_SYSTEM_CXXFLAGS} ${TRICK_TEST_FLAGS}

TRICK_LIBS = -L${TRICK_LIB_DIR} -ltrick -ltrick_mm -ltrick_units -ltrick_mm -ltrick_pyip -ltrick_connection_handlers -ltrick_comm -ltrick_mm -ltrick_units -ltrick -ltrick_mm
TRICK_EXEC_LINK_LIBS += -L${GTEST_HOME}/lib64 -L${GTEST_HOME}/lib -lgtest -lgtest_main

# All tests produced by this Makefile.  Remember to add new tests you
# created to the list.
TESTS = Integrator_unittest

OTHER_OBJECTS = \
    ../../include/object_${TRICK_HOST_CPU}/io_ABM_Integrator.o \
    ../../include/object_${TRICK_HOST_CPU}/io_Euler_Cromer_Integrator.o \
    ../../include/object_${TRICK_HOST_CPU}/io_Euler_Integrator.o \
    ../../include/object_${TRICK_HOST_CPU}/io_Integrator.o \
    ../../include/object_${TRICK_HOST_CPU}/io_MM4_Integrator.o \
    ../../include/object_${TRICK_HOST_CPU}/io_NL2_Integrator.o \
    ../../include/object_${TRICK_HOST_CPU}/io_RK2_Integrator.o \
    ../../include/object_${TRICK_HOST_CPU}/io_RK4_Integrator.o \
    ../../include/object_${TRICK_HOST_CPU}/io_RKF45_Integrator.o \
    ../../include/object_${TRICK_HOST_CPU}/io_RKF78_Integrator.o \
    ../../include/object_${TRICK_HOST_CPU}/io_RKG4_Integrator.o

OTHER_OBJECTS += \
${TRICK_HOME}/trick_source/er7_utils/integration/*/object_${TRICK_HOST_CPU}/*.o \
${TRICK_HOME}/trick_source/er7_utils/interface/object_${TRICK_HOST_CPU}/*.o \
${TRICK_HOME}/trick_source/er7_utils/trick/integration/object_${TRICK_HOST_CPU}/*.o

# House-keeping build targets.

all : $(TESTS)

test: $(TESTS)
	./Integrator_unittest --gtest_output=xml:${TRICK_HOME}/trick_test/Integrator.xml

clean :
	rm -f $(TESTS) *.o
	rm -rf io_src xml

Integrator_unittest.o : Integrator_unittest.cc
	$(TRICK_CXX) $(TRICK_CPPFLAGS) -c $<

Integrator_unittest : Integrator_unittest.o
	$(TRICK_CXX) $(TRICK_SYSTEM_LDFLAGS) -o $@ $^ $(OTHER_OBJECTS) $(TRICK_LIBS) $(TRICK_EXEC_LINK_LIBS)
