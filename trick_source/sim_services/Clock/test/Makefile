
#SYNOPSIS:
#
#   make [all]  - makes everything.
#   make TARGET - makes the given target.
#   make clean  - removes all files generated by make.

include $(dir $(lastword $(MAKEFILE_LIST)))../../../../share/trick/makefiles/Makefile.common

# Flags passed to the preprocessor.
TRICK_CPPFLAGS += -I$(GTEST_HOME)/include -I$(TRICK_HOME)/include -g ${TRICK_SYSTEM_CXXFLAGS} ${TRICK_TEST_FLAGS}
TRICK_LIBS = -L${TRICK_LIB_DIR} -ltrick -ltrick_units -ltrick_mm -ltrick_pyip -ltrick_connection_handlers -ltrick_comm
LIBS = -L${GTEST_HOME}/lib64 -L${GTEST_HOME}/lib -lgtest -lgtest_main


ifeq ($(TRICK_HOST_TYPE), Linux)
    LIBS += -lpthread -lrt
endif

BASE_OBJECTS = ../object_${TRICK_HOST_CPU}/Clock.o\
               ../object_${TRICK_HOST_CPU}/clock_c_intf.o


GETTIMEOFDAY_CLOCK_OBJECTS = ${BASE_OBJECTS} GetTimeOfDayClock_test.o ../object_${TRICK_HOST_CPU}/GetTimeOfDayClock.o exec_get_rt_nap_stub.o

# All tests produced by this Makefile.  Remember to add new tests you
# created to the list.
TESTS = GetTimeOfDayClock_test

# House-keeping build targets.

all : $(TESTS)

test: $(TESTS)
	./GetTimeOfDayClock_test --gtest_output=xml:${TRICK_HOME}/trick_test/GetTimeOfDayClock.xml

clean :
	rm -f $(TESTS) *.o

GetTimeOfDayClock_test.o : GetTimeOfDayClock_test.cpp
	$(TRICK_CXX) $(TRICK_CPPFLAGS) -c $<

GetTimeOfDayClock_test : ${GETTIMEOFDAY_CLOCK_OBJECTS}
	$(TRICK_CXX) $(TRICK_SYSTEM_LDFLAGS) $(TRICK_CPPFLAGS) -o $@ $^ $(TRICK_LIBS) ${LIBS}

exec_get_rt_nap_stub.o : exec_get_rt_nap_stub.cpp
	$(TRICK_CXX) $(TRICK_CPPFLAGS) -c $<
